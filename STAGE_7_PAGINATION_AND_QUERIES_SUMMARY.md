# FastORM ç¬¬ä¸ƒé˜¶æ®µå¼€å‘æ€»ç»“

## ğŸ¯ é˜¶æ®µç›®æ ‡ï¼šåˆ†é¡µä¸æŸ¥è¯¢ä¼˜åŒ–

ç¬¬ä¸ƒé˜¶æ®µè‡´åŠ›äºå®ç°Eloquenté£æ ¼çš„é«˜çº§æŸ¥è¯¢åŠŸèƒ½ï¼ŒåŒ…æ‹¬æŸ¥è¯¢ä½œç”¨åŸŸç³»ç»Ÿã€å¢å¼ºåˆ†é¡µå’Œæ‰¹é‡æ“ä½œæ”¯æŒã€‚

## ğŸ“Š å®ŒæˆåŠŸèƒ½

### 1. æŸ¥è¯¢ä½œç”¨åŸŸç³»ç»Ÿ âœ…

#### æ ¸å¿ƒç‰¹æ€§
- **@scopeè£…é¥°å™¨**ï¼šå®šä¹‰å¯å¤ç”¨çš„æŸ¥è¯¢ä½œç”¨åŸŸ
- **@global_scopeè£…é¥°å™¨**ï¼šå®šä¹‰è‡ªåŠ¨åº”ç”¨çš„å…¨å±€ä½œç”¨åŸŸ
- **ScopeMixin**ï¼šä¸ºModelåŸºç±»æä¾›ä½œç”¨åŸŸæ”¯æŒ
- **ä½œç”¨åŸŸé“¾å¼è°ƒç”¨**ï¼šæ”¯æŒå¤šä¸ªä½œç”¨åŸŸç»„åˆä½¿ç”¨

#### å®ç°æ–‡ä»¶
- `fastorm/mixins/scopes.py` - ä½œç”¨åŸŸç³»ç»Ÿæ ¸å¿ƒå®ç°
- `fastorm/model/model.py` - é›†æˆScopeMixinåˆ°ModelåŸºç±»

#### ä½¿ç”¨ç¤ºä¾‹
```python
class User(Model):
    @scope
    def active(self, query):
        return query.where('status', 'active')
    
    @scope
    def by_role(self, query, role: str):
        return query.where('role', role)
    
    @global_scope('soft_delete')
    def apply_soft_delete_filter(self, query):
        return query.where('is_deleted', False)

# ä½¿ç”¨æ–¹å¼
active_admins = await User.query().active().by_role('admin').get()
all_users = await User.query().without_global_scope('soft_delete').get()
```

### 2. å¢å¼ºåˆ†é¡µåŠŸèƒ½ âœ…

#### æ ¸å¿ƒç‰¹æ€§
- **Paginatorç±»**ï¼šå®Œæ•´çš„åˆ†é¡µå™¨ï¼ŒåŒ…å«æ€»æ•°è®¡ç®—
- **SimplePaginatorç±»**ï¼šç®€å•åˆ†é¡µå™¨ï¼Œé€‚ç”¨äºå¤§æ•°æ®é›†
- **åˆ†é¡µé“¾æ¥ç”Ÿæˆ**ï¼šæ”¯æŒURLç”Ÿæˆå’Œå‚æ•°ä¼ é€’
- **åˆ†é¡µä¿¡æ¯å®Œæ•´**ï¼šæä¾›ä¸°å¯Œçš„åˆ†é¡µçŠ¶æ€ä¿¡æ¯

#### å®ç°æ–‡ä»¶
- `fastorm/query/pagination.py` - åˆ†é¡µå™¨å®ç°
- `fastorm/query/builder.py` - QueryBuilderåˆ†é¡µæ–¹æ³•å¢å¼º

#### ä½¿ç”¨ç¤ºä¾‹
```python
# æ ‡å‡†åˆ†é¡µ
paginator = await User.where('status', 'active').paginate(page=1, per_page=20)
print(f"æ€»è®°å½•æ•°: {paginator.total}")
print(f"å½“å‰é¡µ: {paginator.current_page}/{paginator.last_page}")

# ç®€å•åˆ†é¡µï¼ˆä¸è®¡ç®—æ€»æ•°ï¼‰
simple_paginator = await User.simple_paginate(page=1, per_page=20)
print(f"æ˜¯å¦æœ‰æ›´å¤š: {simple_paginator.has_more}")

# åˆ†é¡µå™¨åºåˆ—åŒ–
page_data = paginator.to_dict()
```

### 3. æ‰¹é‡æ“ä½œæ”¯æŒ âœ…

#### æ ¸å¿ƒç‰¹æ€§
- **åˆ†å—å¤„ç†ï¼ˆchunkï¼‰**ï¼šå°†å¤§æ•°æ®é›†åˆ†å—å¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º
- **é€ä¸ªå¤„ç†ï¼ˆeachï¼‰**ï¼šå¯¹æ¯æ¡è®°å½•æ‰§è¡Œå›è°ƒå‡½æ•°
- **æ‰¹é‡æ›´æ–°ï¼ˆbatch_updateï¼‰**ï¼šæ‰¹é‡æ›´æ–°ç¬¦åˆæ¡ä»¶çš„è®°å½•
- **æ‰¹é‡æ’å…¥ï¼ˆbatch_insertï¼‰**ï¼šæ‰¹é‡åˆ›å»ºå¤šæ¡è®°å½•
- **æ¸¸æ ‡åˆ†é¡µï¼ˆcursor_paginateï¼‰**ï¼šåŸºäºæ¸¸æ ‡çš„é«˜æ€§èƒ½åˆ†é¡µ

#### å®ç°æ–‡ä»¶
- `fastorm/query/batch.py` - æ‰¹é‡æ“ä½œå®ç°
- `fastorm/query/builder.py` - QueryBuilderæ‰¹é‡æ–¹æ³•å¢å¼º

#### ä½¿ç”¨ç¤ºä¾‹
```python
# åˆ†å—å¤„ç†
await User.where('status', 'pending').chunk(100, process_users)

# é€ä¸ªå¤„ç†
await User.where('role', 'admin').each(send_notification)

# æ‰¹é‡æ›´æ–°
await User.where('age', '<', 18).batch().batch_update({'category': 'minor'})

# æ‰¹é‡æ’å…¥
users_data = [{'name': 'User1'}, {'name': 'User2'}]
await User.batch().batch_insert(users_data)

# æ¸¸æ ‡åˆ†é¡µ
result = await User.batch().cursor_paginate('id', limit=50)
```

## ğŸ”§ æŠ€æœ¯å®ç°äº®ç‚¹

### 1. ä¼˜é›…çš„è£…é¥°å™¨è®¾è®¡
- ä½¿ç”¨Pythonè£…é¥°å™¨å®ç°ä½œç”¨åŸŸæ³¨å†Œ
- æ”¯æŒå¸¦å‚æ•°å’Œä¸å¸¦å‚æ•°çš„ä½œç”¨åŸŸ
- è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œæœºåˆ¶

### 2. ç±»å‹å®‰å…¨æ”¯æŒ
- å®Œæ•´çš„TypeScripté£æ ¼ç±»å‹æ³¨è§£
- æ³›å‹æ”¯æŒç¡®ä¿ç±»å‹æ¨æ–­
- TYPE_CHECKINGé¿å…å¾ªç¯å¯¼å…¥

### 3. æ€§èƒ½ä¼˜åŒ–è€ƒè™‘
- åˆ†å—å¤„ç†é¿å…å†…å­˜æº¢å‡º
- æ¸¸æ ‡åˆ†é¡µæ”¯æŒå¤§æ•°æ®é›†
- ç®€å•åˆ†é¡µå™¨å‡å°‘è®¡ç®—å¼€é”€

### 4. APIè®¾è®¡ä¸€è‡´æ€§
- ä¿æŒFastORMçš„é“¾å¼è°ƒç”¨é£æ ¼
- ä¸ç°æœ‰QueryBuilderæ— ç¼é›†æˆ
- ç¬¦åˆ"ç®€æ´ã€ä¼˜é›…ã€ç°ä»£"è®¾è®¡åŸåˆ™

## ğŸ“ æ–‡ä»¶ç»“æ„

```
FastORM/
â”œâ”€â”€ fastorm/
â”‚   â”œâ”€â”€ mixins/
â”‚   â”‚   â”œâ”€â”€ scopes.py          # ä½œç”¨åŸŸç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ __init__.py        # æ›´æ–°å¯¼å‡º
â”‚   â”œâ”€â”€ query/
â”‚   â”‚   â”œâ”€â”€ pagination.py      # åˆ†é¡µå™¨ç±»
â”‚   â”‚   â”œâ”€â”€ batch.py          # æ‰¹é‡æ“ä½œ
â”‚   â”‚   â””â”€â”€ builder.py        # QueryBuilderå¢å¼º
â”‚   â””â”€â”€ model/
â”‚       â””â”€â”€ model.py          # é›†æˆScopeMixin
â””â”€â”€ examples/
    â”œâ”€â”€ stage_7_demo.py       # å®Œæ•´æ¼”ç¤ºï¼ˆéœ€è¦æ•°æ®åº“ï¼‰
    â””â”€â”€ simple_stage_7_test.py # ç®€åŒ–æµ‹è¯•
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•
- âœ… ä½œç”¨åŸŸè£…é¥°å™¨æ³¨å†Œå’Œè°ƒç”¨
- âœ… åˆ†é¡µå™¨åˆ›å»ºå’Œå±æ€§è®¡ç®—
- âœ… æ‰¹é‡å¤„ç†å™¨åˆå§‹åŒ–
- âœ… ä½œç”¨åŸŸä¸QueryBuilderé›†æˆ

### å…¼å®¹æ€§æµ‹è¯•
- âœ… ä¸ç°æœ‰ModelåŸºç±»å…¼å®¹
- âœ… ä¸äº‹ä»¶ç³»ç»Ÿå…¼å®¹
- âœ… ä¸Pydanticé›†æˆå…¼å®¹

## ğŸš€ æ€§èƒ½ä¼˜åŠ¿

### 1. æŸ¥è¯¢ä¼˜åŒ–
- ä½œç”¨åŸŸé¢„ç¼–è¯‘å‡å°‘é‡å¤æŸ¥è¯¢æ„å»º
- å…¨å±€ä½œç”¨åŸŸè‡ªåŠ¨åº”ç”¨æé«˜å®‰å…¨æ€§
- ä½œç”¨åŸŸé“¾å¼è°ƒç”¨æé«˜ä»£ç å¤ç”¨æ€§

### 2. å†…å­˜ç®¡ç†
- åˆ†å—å¤„ç†é¿å…å¤§æ•°æ®é›†å†…å­˜æº¢å‡º
- æ¸¸æ ‡åˆ†é¡µé¿å…OFFSETæ€§èƒ½é—®é¢˜
- ç®€å•åˆ†é¡µå™¨å‡å°‘COUNTæŸ¥è¯¢

### 3. å¼€å‘æ•ˆç‡
- ä½œç”¨åŸŸå‡å°‘é‡å¤æŸ¥è¯¢ä»£ç 
- åˆ†é¡µå™¨æä¾›å®Œæ•´çš„åˆ†é¡µä¿¡æ¯
- æ‰¹é‡æ“ä½œç®€åŒ–æ•°æ®å¤„ç†æµç¨‹

## ğŸ’¡ è®¾è®¡åŸåˆ™éªŒè¯

### "ç®€æ´å¦‚ThinkORM" âœ…
```python
# ç®€æ´çš„ä½œç”¨åŸŸä½¿ç”¨
users = await User.active().adults().get()

# ç®€æ´çš„åˆ†é¡µ
paginator = await User.paginate(page=1, per_page=20)
```

### "ä¼˜é›…å¦‚Eloquent" âœ…
```python
# Eloquenté£æ ¼çš„ä½œç”¨åŸŸ
@scope
def high_balance(self, query, min_amount=1000):
    return query.where('balance', '>=', min_amount)

# Eloquenté£æ ¼çš„æ‰¹é‡æ“ä½œ
await User.where('status', 'inactive').chunk(100, notify_users)
```

### "ç°ä»£å¦‚FastAPI" âœ…
```python
# ç±»å‹å®‰å…¨çš„æ³›å‹æ”¯æŒ
class QueryBuilder(Generic[T]):
    def paginate(self, ...) -> Paginator[T]: ...

# å¼‚æ­¥æ”¯æŒå’Œç°ä»£è¯­æ³•
async def chunk(self, size: int, callback: Callable[[List[T]], Any]) -> int:
```

## ğŸ”„ ä¸å…¶ä»–é˜¶æ®µçš„é›†æˆ

### ä¸ç¬¬äº”é˜¶æ®µï¼ˆäº‹ä»¶ç³»ç»Ÿï¼‰
- ä½œç”¨åŸŸç³»ç»Ÿä¸äº‹ä»¶ç³»ç»Ÿæ— å†²çª
- æ‰¹é‡æ“ä½œå¯ä»¥è§¦å‘ç›¸åº”äº‹ä»¶

### ä¸ç¬¬å…­é˜¶æ®µï¼ˆPydanticéªŒè¯ï¼‰
- åˆ†é¡µå™¨æ”¯æŒPydanticåºåˆ—åŒ–
- æ‰¹é‡æ“ä½œæ”¯æŒéªŒè¯åçš„æ•°æ®

## ğŸ“ˆ åç»­æ‰©å±•æ–¹å‘

### 1. æ€§èƒ½ç›‘æ§
- æŸ¥è¯¢æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
- ä½œç”¨åŸŸä½¿ç”¨é¢‘ç‡åˆ†æ
- åˆ†é¡µæ€§èƒ½ä¼˜åŒ–å»ºè®®

### 2. é«˜çº§ç‰¹æ€§
- åŠ¨æ€ä½œç”¨åŸŸæ¡ä»¶
- è‡ªå®šä¹‰åˆ†é¡µå™¨ç±»å‹
- æ›´å¤šæ‰¹é‡æ“ä½œç±»å‹

### 3. å¼€å‘å·¥å…·
- ä½œç”¨åŸŸå¯è§†åŒ–å·¥å…·
- æŸ¥è¯¢æ€§èƒ½åˆ†æå™¨
- åˆ†é¡µè°ƒè¯•åŠ©æ‰‹

## ğŸ‰ é˜¶æ®µæ€»ç»“

ç¬¬ä¸ƒé˜¶æ®µæˆåŠŸå®ç°äº†Eloquenté£æ ¼çš„é«˜çº§æŸ¥è¯¢åŠŸèƒ½ï¼Œä¸ºFastORMæä¾›äº†ï¼š

1. **å¼ºå¤§çš„ä½œç”¨åŸŸç³»ç»Ÿ** - æé«˜æŸ¥è¯¢ä»£ç å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§
2. **å®Œå–„çš„åˆ†é¡µåŠŸèƒ½** - æ”¯æŒå„ç§åˆ†é¡µåœºæ™¯å’Œæ€§èƒ½éœ€æ±‚
3. **é«˜æ•ˆçš„æ‰¹é‡æ“ä½œ** - å¤„ç†å¤§æ•°æ®é›†çš„æœ€ä½³å®è·µ

è¿™äº›åŠŸèƒ½å®Œç¾ä½“ç°äº†FastORMçš„è®¾è®¡ç›®æ ‡ï¼š
- ç®€æ´çš„APIè®¾è®¡
- ä¼˜é›…çš„åŠŸèƒ½å®ç°  
- ç°ä»£çš„æŠ€æœ¯æ ‡å‡†

ç¬¬ä¸ƒé˜¶æ®µä¸ºFastORMçš„æŸ¥è¯¢ç³»ç»Ÿå¥ å®šäº†åšå®çš„åŸºç¡€ï¼Œä¸ºåç»­çš„æ¨¡å‹å·¥å‚ã€æµ‹è¯•æ”¯æŒç­‰é«˜çº§ç‰¹æ€§åšå¥½äº†å‡†å¤‡ã€‚ 